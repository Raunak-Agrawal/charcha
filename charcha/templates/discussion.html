{% extends "base.html" %}
{% load humanize %}
{% load markdown %}

{% block title %}{{ post.title }} | Charcha{% endblock %}

{% block content %}
{% spaceless %}
<div class="post">
  <div class="post-title">
    <h2>{{ post.title }}</h2>
  </div>
  <div class="post-line-2">
    <div class="post-score">
        by {{ post.author.username }} | 
        {% if request.user.id == post.author.id %}
        <a href="{% url 'edit-discussion' post.id %}">edit</a> | 
        {% endif %}
      {{ post.score }} point{{ post.score | pluralize }} | 
      {{ comments|length }} comment{{ comments | length | pluralize }} |
      {{ post.submission_time | naturaltime }}

      {% if request.user.is_staff %}
      | <a href="{% url 'admin:discussions_post_change' post.id %}">admin</a>
      {% endif %}
    </div>
  </div>
  {% if post.text %}
  <div class="panel post-text">
    <p>{{post.text | markdown}}</p>
  </div>
  {% endif %}
  {% include "partials/post-vote-control.html" with obj_type='posts' obj=post %}
  <form method="post" action="">
    {% csrf_token %}
    <input type="hidden" id="trix-text" name="text" value="Hello, trix!"/>
    <trix-editor class="trix-content" input="trix-text"></trix-editor>
    <button type="submit" class="btn btn-default">Add Comment</button>
  </form>
</div>

{% for comment in comments %}
<div id="comment-{{comment.id}}" class="panel comment indent-{{comment.indent}}">
  <div class="comment-header">
    <span class="comment-author">
      <a href="#">{{ comment.author.username }}</a>
    </span>
    <span>&nbsp;</span>
    <span>{{comment.score}} points</span>
    <span>, </span>
    <span class="comment-submission-time">{{ comment.submission_time | naturaltime }}</span>
    <span><a class="btn" href="#comment-{{comment.id}}">permalink</a></span>
    
  </div>
  <div class="comment-text">
    <p>
      {{ comment.text | markdown}}
    </p>
  </div>
  <div class="comment-footer btn-group btn-group-sm" role="group">
    {% include "partials/post-vote-control.html" with obj_type='comments' obj=comment %}
    {% if comment.indent < 12 %}
    <a class="btn comment-action reply" href="{% url 'reply_to_comment' comment.id %}">
      <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
      reply
    </a>
    {% else %}
    <span><i>replies not allowed anymore</i></span>
    {% endif %}
    {% if request.user.username == comment.author.username %}
    <a class="btn" href="{% url 'edit_comment' comment.id %}">
      <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
      edit
    </a>
    {% endif %}
    {% if request.user.is_staff %}
    <a class="btn" href="{% url 'admin:discussions_comment_change' comment.id %}">admin</a>
    {% endif %}
  </div>
</div>
{% endfor %}

{% endspaceless %}
{% endblock %}
